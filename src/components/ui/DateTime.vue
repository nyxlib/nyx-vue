<!--suppress JSUnresolvedReference, JSUnusedGlobalSymbols -->
<script setup>
/*--------------------------------------------------------------------------------------------------------------------*/

import {ref, watch, onMounted, onUnmounted} from 'vue';

/*--------------------------------------------------------------------------------------------------------------------*/

import flatpickr from 'flatpickr';

/*--------------------------------------------------------------------------------------------------------------------*/
/* VARIABLES                                                                                                          */
/*--------------------------------------------------------------------------------------------------------------------*/

const props = defineProps({
    inline: {
        type: Boolean,
        default: true,
    },
    enableTime: {
        type: Boolean,
        default: true,
    },
    modelValue: {
        type: [Date, null],
        default: null,
    },
});

/*--------------------------------------------------------------------------------------------------------------------*/

const emit = defineEmits(['date-change', 'update:modelValue']);

/*--------------------------------------------------------------------------------------------------------------------*/

const inputRef = ref(null);

/*--------------------------------------------------------------------------------------------------------------------*/

let flatpickrInstance = null;

/*--------------------------------------------------------------------------------------------------------------------*/
/* INITIALIZATION                                                                                                     */
/*--------------------------------------------------------------------------------------------------------------------*/

onMounted(() => {

    /*----------------------------------------------------------------------------------------------------------------*/

    // noinspection JSValidateTypes
    flatpickrInstance = flatpickr(inputRef.value, {
        dateFormat: 'Z',
        time_24hr: true,
        inline: props.inline,
        enableTime: props.enableTime,
        defaultDate: (props.modelValue ?? new Date()).toISOString(),
        onChange: (dates) => {

            if(dates.length > 0)
            {
                emit('update:modelValue', dates[0]);

                emit('date-change', dates[0]);
            }
        },
    });

    /*----------------------------------------------------------------------------------------------------------------*/

    watch(() => props.modelValue, (value) => {

        if(flatpickrInstance.selectedDates?.[0]?.getTime() !== value.getTime() && value instanceof Date)
        {
            flatpickrInstance.setDate(value, true);
        }
    });

    /*----------------------------------------------------------------------------------------------------------------*/
});

/*--------------------------------------------------------------------------------------------------------------------*/

onUnmounted(() => {

    flatpickrInstance.destroy();
});

/*--------------------------------------------------------------------------------------------------------------------*/
</script>

<template>

    <!-- *********************************************************************************************************** -->

    <input type="text" :hidden="inline" ref="inputRef" />

    <!-- *********************************************************************************************************** -->

</template>
