<!--suppress JSUnresolvedReference -->
<script setup>
/*--------------------------------------------------------------------------------------------------------------------*/

import {ref, watch, provide, nextTick, onMounted} from 'vue';

/*--------------------------------------------------------------------------------------------------------------------*/
/* VARIABLES                                                                                                          */
/*--------------------------------------------------------------------------------------------------------------------*/

defineProps({
    margin: {
        type: String,
        default: 'mb-4',
    },
});

/*--------------------------------------------------------------------------------------------------------------------*/

const tabs = ref({});

const tabListRef = ref(null);

/*--------------------------------------------------------------------------------------------------------------------*/
/* FUNCTIONS                                                                                                          */
/*--------------------------------------------------------------------------------------------------------------------*/

provide('addTab', (tabId, tabTitle, tabIcon, onShow, onShown, onHide, onHidden) => {

    tabs.value[tabId] = {
        tabId: tabId,
        tabTitle: tabTitle,
        tabIcon: tabIcon,
        onShow: onShow,
        onShown: onShown,
        onHide: onHide,
        onHidden: onHidden,
    };

    return Object.keys(tabs.value).length === 1;
});

/*--------------------------------------------------------------------------------------------------------------------*/

provide('delTab', (tabId) => {

    delete tabs.value[tabId];
});

/*--------------------------------------------------------------------------------------------------------------------*/

provide('updateTitle', (tabId, tabTitle) => {

    tabs.value[tabId].tabTitle = tabTitle;
});

/*--------------------------------------------------------------------------------------------------------------------*/

provide('updateIcon', (tabId, tabIcon) => {

    tabs.value[tabId].tabIcon = tabIcon;
});

/*--------------------------------------------------------------------------------------------------------------------*/
/* INITIALIZATION                                                                                                     */
/*--------------------------------------------------------------------------------------------------------------------*/

onMounted(() => {

    watch(tabs, () => {

        nextTick().then(() => {

            Object.values(tabs.value).forEach((tab) => {

                const el = tabListRef.value.querySelector(`button[data-bs-target="#${tab.tabId}"]`);

                if(el)
                {
                    el.addEventListener('show.bs.tab', tab.onShow);
                    el.addEventListener('shown.bs.tab', tab.onShown);
                    el.addEventListener('hide.bs.tab', tab.onHide);
                    el.addEventListener('hidden.bs.tab', tab.onHidden);
                }
            });
        });

    }, {immediate: true});
});

/*--------------------------------------------------------------------------------------------------------------------*/
</script>

<template>

    <!-- *********************************************************************************************************** -->
    <!-- NAV TABS                                                                                                    -->
    <!-- *********************************************************************************************************** -->

    <div :class="['nav', 'nav-tabs', margin]" role="tablist" ref="tabListRef">

        <!-- ******************************************************************************************************* -->

        <button :class="['nav-link', 'px-3', 'py-2', {'active': idx === 0}]" type="button" data-bs-toggle="tab" :data-bs-target="`#${tab.tabId}`" role="tab" v-for="(tab, _, idx) in tabs" :key="idx">

            <i :class="['bi', `bi-${tab.tabIcon}`]" v-if="tab.tabIcon"></i>

            {{ tab.tabTitle }}

        </button>

        <!-- ******************************************************************************************************* -->

        <div class="ms-auto">

            <slot name="button"></slot>

        </div>

        <!-- ******************************************************************************************************* -->

    </div>

    <!-- *********************************************************************************************************** -->
    <!-- TABS CONTENT                                                                                                -->
    <!-- *********************************************************************************************************** -->

    <div class="tab-content flex-grow-1">

        <slot></slot>

    </div>

    <!-- *********************************************************************************************************** -->

</template>
