<script setup>
/*--------------------------------------------------------------------------------------------------------------------*/

import {inject, onMounted, onUnmounted} from 'vue';

/*--------------------------------------------------------------------------------------------------------------------*/

import useNyxStore from '../../stores/nyx';

/*--------------------------------------------------------------------------------------------------------------------*/
/* VARIABLES                                                                                                          */
/*--------------------------------------------------------------------------------------------------------------------*/

const nyx = inject('nyx');

/*--------------------------------------------------------------------------------------------------------------------*/

const nyxStore = useNyxStore();

/*--------------------------------------------------------------------------------------------------------------------*/

const props = defineProps({
    deviceName: {
        type: String,
        default: '',
    },
});

/*--------------------------------------------------------------------------------------------------------------------*/

let modalEl = null;
let terminalEl = null;

/*--------------------------------------------------------------------------------------------------------------------*/
/* FUNCTIONS                                                                                                          */
/*--------------------------------------------------------------------------------------------------------------------*/

const setupAndUpdateTerminal = () => {

    nyx.setupTerminal(terminalEl, props.deviceName);

    nyx.updateTerminal();
};

/*--------------------------------------------------------------------------------------------------------------------*/
/* INITIALIZATION                                                                                                     */
/*--------------------------------------------------------------------------------------------------------------------*/

onMounted(() => {

    modalEl = document.getElementById('nyx_console');
    terminalEl = document.getElementById('nyx_terminal');

    /**/

    modalEl.addEventListener('shown.bs.modal', setupAndUpdateTerminal);
});

/*--------------------------------------------------------------------------------------------------------------------*/

onUnmounted(() => {

    modalEl.removeEventListener('shown.bs.modal', setupAndUpdateTerminal);

    /**/

    modalEl = /*----------------*/ null /*----------------*/;
    terminalEl = /*----------------*/ null /*----------------*/;
});

/*--------------------------------------------------------------------------------------------------------------------*/
</script>

<template>

    <!-- *********************************************************************************************************** -->

    <button class="btn btn-xs btn-secondary" type="button" data-bs-toggle="modal" data-bs-target="#nyx_console">
        <i class="bi bi-card-text"></i>
        logs
        <span class="badge rounded-pill bg-danger">
            {{ nyxStore.numberOfMessages(props.deviceName) }}
            <span class="visually-hidden">available messages</span>
        </span>
    </button>

    <!-- *********************************************************************************************************** -->

</template>
